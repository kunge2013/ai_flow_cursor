# AI Flow 向量检索功能说明

## 功能概述

本项目实现了基于向量库的知识库检索系统，支持文档上传、向量化和智能检索功能。

## 主要特性

### 1. 前端优化
- **富文本编辑器**: 使用自定义富文本编辑器，支持格式化文本、标题、列表等
- **文件上传组件**: 支持拖拽上传，支持多种文件格式
- **文档库上传**: 支持文件夹批量上传和预览
- **响应式设计**: 现代化的UI界面，支持各种屏幕尺寸

### 2. 后端接口
- **向量化服务**: 支持多种向量模型（OpenAI、智普、DeepSeek）
- **向量检索**: 基于相似度的智能文档检索
- **批量处理**: 支持批量文档向量化
- **RESTful API**: 完整的REST接口设计

### 3. 支持的文件格式
- 文本文件: `.txt`, `.md`
- 办公文档: `.doc`, `.docx`, `.xlsx`, `.xls`
- PDF文档: `.pdf`

## 技术架构

### 前端技术栈
- Vue 3 + TypeScript
- Element Plus UI组件库
- 自定义富文本编辑器
- 文件上传组件

### 后端技术栈
- Spring Boot 3
- MyBatis Plus
- 向量检索服务
- SQLite数据库（可扩展）

## 安装和配置

### 1. 前端依赖安装
```bash
cd ai-flow-ui
yarn add @wangeditor/editor @wangeditor/editor-for-vue @element-plus/icons-vue
```

### 2. 后端配置
确保后端服务已启动，并执行数据库初始化脚本：
```sql
-- 执行 schema-vector.sql 创建向量存储相关表
```

### 3. 环境配置
在 `application.yml` 中配置向量模型参数：
```yaml
vector:
  models:
    openai:
      api-key: ${OPENAI_API_KEY}
      model: text-embedding-ada-002
    zhipu:
      api-key: ${ZHIPU_API_KEY}
      model: embedding-2
    deepseek:
      api-key: ${DEEPSEEK_API_KEY}
      model: deepseek-embedding
```

## 使用说明

### 1. 创建知识库
1. 点击"创建知识库"按钮
2. 填写知识库名称、描述
3. 选择向量模型
4. 设置标签和状态

### 2. 上传文档
支持三种上传方式：

#### 文件上传
- 支持拖拽上传
- 自动文件类型验证
- 文件大小限制（默认50MB）

#### 手动录入
- 使用富文本编辑器
- 支持格式化文本
- 实时字数统计

#### 文档库上传
- 支持文件夹选择
- 批量文件预览
- 自动文件验证

### 3. 向量检索
1. 在"命中测试"标签页中输入查询内容
2. 设置检索参数（条数、相似度阈值）
3. 点击"发送"进行向量检索
4. 查看检索结果和相似度分数

## API接口

### 向量检索接口
- `POST /api/vector/embed` - 文档向量化
- `POST /api/vector/search` - 向量相似度搜索
- `POST /api/vector/batch-embed` - 批量向量化
- `POST /api/vector/document/save` - 保存文档向量
- `DELETE /api/vector/document/{id}` - 删除文档向量
- `PUT /api/vector/document/{id}` - 更新文档向量

### 知识库接口
- `GET /api/kb` - 获取知识库列表
- `POST /api/kb` - 创建知识库
- `PUT /api/kb/{id}` - 更新知识库
- `DELETE /api/kb/{id}` - 删除知识库

## 扩展说明

### 1. 向量数据库集成
当前使用模拟实现，可以集成以下向量数据库：
- **Pinecone**: 云原生向量数据库
- **Weaviate**: 开源向量搜索引擎
- **Qdrant**: 高性能向量相似度搜索
- **Chroma**: 嵌入式向量数据库

### 2. 向量模型扩展
支持添加新的向量模型：
1. 在 `VectorSearchServiceImpl` 中添加模型配置
2. 实现对应的向量化逻辑
3. 更新前端模型选择器

### 3. 文件处理器扩展
支持更多文件格式：
1. 添加文件解析器
2. 实现内容提取逻辑
3. 更新文件类型验证

## 性能优化

### 1. 批量处理
- 使用异步处理进行批量向量化
- 线程池管理并发任务
- 批量数据库操作

### 2. 缓存策略
- 向量结果缓存
- 文档内容缓存
- 搜索结果缓存

### 3. 索引优化
- 向量索引表优化
- 数据库查询优化
- 分页查询支持

## 故障排除

### 常见问题

1. **向量化失败**
   - 检查API密钥配置
   - 验证网络连接
   - 查看服务日志

2. **检索结果为空**
   - 检查相似度阈值设置
   - 确认知识库中有文档
   - 验证向量模型配置

3. **文件上传失败**
   - 检查文件格式支持
   - 验证文件大小限制
   - 确认存储权限

### 日志查看
```bash
# 查看后端日志
tail -f logs/ai-flow-server.log

# 查看前端控制台
# 在浏览器开发者工具中查看Console和Network标签
```

## 开发计划

### 短期目标
- [ ] 集成真实的向量数据库
- [ ] 添加更多文件格式支持
- [ ] 优化检索算法性能

### 长期目标
- [ ] 支持多语言向量检索
- [ ] 实现增量向量更新
- [ ] 添加检索结果排序和过滤
- [ ] 支持向量检索的实时流式处理

## 贡献指南

欢迎提交Issue和Pull Request来改进这个项目！

### 开发环境设置
1. Fork项目仓库
2. 创建功能分支
3. 提交代码变更
4. 创建Pull Request

### 代码规范
- 遵循现有的代码风格
- 添加适当的注释和文档
- 编写单元测试
- 确保代码通过所有检查

## 许可证

本项目采用MIT许可证，详见LICENSE文件。 